<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"eazow.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"remove","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"giscus","storage":true,"lazyload":true,"nav":null,"activeClass":"giscus"},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/config.min.js"></script>



<link rel="canonical" href="http://eazow.com/linux-kernel-custom-syscall/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en-US","comments":true,"permalink":"http://eazow.com/linux-kernel-custom-syscall/","path":"linux-kernel-custom-syscall/","title":"ç¼–è¯‘Linuxå†…æ ¸å¢åŠ ç³»ç»Ÿè°ƒç”¨"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ç¼–è¯‘Linuxå†…æ ¸å¢åŠ ç³»ç»Ÿè°ƒç”¨ | Eazow</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NHS1WWDHJE"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-NHS1WWDHJE","only_pageview":false}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/third-party/analytics/google-analytics.min.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <!--i class="logo-line"></i-->
      <p class="site-title">Eazow</p>
      <!--i class="logo-line"></i-->
    </a>
      <p class="site-subtitle" itemprop="description">Stay kind and positive</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
    </header>
    <div class="banner"></div>

    

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en-US">
    <link itemprop="mainEntityOfPage" href="http://eazow.com/linux-kernel-custom-syscall/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eazow">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eazow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ç¼–è¯‘Linuxå†…æ ¸å¢åŠ ç³»ç»Ÿè°ƒç”¨ | Eazow">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ç¼–è¯‘Linuxå†…æ ¸å¢åŠ ç³»ç»Ÿè°ƒç”¨
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2008-02-29 18:50:36" itemprop="dateCreated datePublished" datetime="2008-02-29T18:50:36+08:00">2008-02-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>3 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p><strong>å®éªŒç¯å¢ƒ</strong>ï¼šUbuntu 7.10 + Linux Kernel 2.6.23.12<br><strong>è€—æ—¶</strong>ï¼šçº¦ 2-3 å°æ—¶ï¼ˆä¸»è¦æ˜¯ç¼–è¯‘æ—¶é—´ï¼‰<br><strong>éš¾åº¦</strong>ï¼šâ­â­â­</p>
</blockquote>
<p>ç»è¿‡ä¸€ä¸¤å¤©çš„æ‘¸ç´¢ï¼Œç»ˆäºåœ¨ Ubuntu è™šæ‹Ÿæœºä¸­æˆåŠŸå®Œæˆäº†å†…æ ¸ç¼–è¯‘å’Œç³»ç»Ÿè°ƒç”¨æ·»åŠ å®éªŒã€‚æœŸé—´è¸©äº†ä¸å°‘å‘ï¼Œæ¢äº†å‡ ä¸ªå†…æ ¸ç‰ˆæœ¬ï¼Œé‡æ–°ç¼–è¯‘äº†å¤šæ¬¡ã€‚ç°å°†å®Œæ•´æ­¥éª¤æ•´ç†å¦‚ä¸‹ï¼Œå¸Œæœ›èƒ½æœ‰æ‰€å¸®åŠ©ï¼</p>
<h2 id="ğŸ“‹-å‡†å¤‡å·¥ä½œ"><a href="#ğŸ“‹-å‡†å¤‡å·¥ä½œ" class="headerlink" title="ğŸ“‹ å‡†å¤‡å·¥ä½œ"></a>ğŸ“‹ å‡†å¤‡å·¥ä½œ</h2><h3 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h3><ul>
<li>Ubuntu 7.10 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>è‡³å°‘ 20GB ç£ç›˜ç©ºé—´</li>
<li>4GB ä»¥ä¸Šå†…å­˜ï¼ˆè™šæ‹Ÿæœºå»ºè®®åˆ†é… 2GB+ï¼‰</li>
</ul>
<h3 id="ä¸‹è½½å†…æ ¸æºç "><a href="#ä¸‹è½½å†…æ ¸æºç " class="headerlink" title="ä¸‹è½½å†…æ ¸æºç "></a>ä¸‹è½½å†…æ ¸æºç </h3><p>è®¿é—® <a target="_blank" rel="noopener" href="https://www.kernel.org/">https://www.kernel.org</a> ä¸‹è½½ Linux å†…æ ¸æºç åŒ…ï¼ˆæœ¬æ–‡ä½¿ç”¨ <code>linux-2.6.23.12.tar.gz</code>ï¼‰</p>
<h2 id="ğŸ”§-è¯¦ç»†æ­¥éª¤"><a href="#ğŸ”§-è¯¦ç»†æ­¥éª¤" class="headerlink" title="ğŸ”§ è¯¦ç»†æ­¥éª¤"></a>ğŸ”§ è¯¦ç»†æ­¥éª¤</h2><h3 id="1-è§£å‹å†…æ ¸æºç "><a href="#1-è§£å‹å†…æ ¸æºç " class="headerlink" title="1. è§£å‹å†…æ ¸æºç "></a>1. è§£å‹å†…æ ¸æºç </h3><p>å°†å†…æ ¸åŒ…è§£å‹åˆ° <code>/usr/src</code> ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src</span><br><span class="line">sudo tar jxvf linux-2.6.23.12.tar.bz2</span><br><span class="line"><span class="comment"># æˆ–è€…å¦‚æœæ˜¯ .tar.gz æ ¼å¼</span></span><br><span class="line">sudo tar zxvf linux-2.6.23.12.tar.gz</span><br></pre></td></tr></table></figure>



<h3 id="2-æ·»åŠ è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨"><a href="#2-æ·»åŠ è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="2. æ·»åŠ è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨"></a>2. æ·»åŠ è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨</h3><h4 id="2-1-ä¿®æ”¹-sys-c-æ–‡ä»¶"><a href="#2-1-ä¿®æ”¹-sys-c-æ–‡ä»¶" class="headerlink" title="2.1 ä¿®æ”¹ sys.c æ–‡ä»¶"></a>2.1 ä¿®æ”¹ <code>sys.c</code> æ–‡ä»¶</h4><p>åœ¨å†…æ ¸æºç ä¸­æ·»åŠ ç³»ç»Ÿè°ƒç”¨å®ç°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src/linux-2.6.23.12</span><br><span class="line">sudo vim kernel/sys.c</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨ï¼šæ‰“å°æ¶ˆæ¯å¹¶è¿”å›å‚æ•° */</span></span><br><span class="line">asmlinkage <span class="type">int</span> <span class="title function_">sys_mysyscall</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Hello from mysyscall! Received: %d\n&quot;</span>, num);</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>asmlinkage</code> æ˜¯å¿…éœ€çš„ï¼Œè¡¨ç¤ºå‚æ•°é€šè¿‡æ ˆä¼ é€’ã€‚</p>
</blockquote>
<h4 id="2-2-ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨"><a href="#2-2-ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨" class="headerlink" title="2.2 ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨"></a>2.2 ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨</h4><p>ç¼–è¾‘ç³»ç»Ÿè°ƒç”¨è¡¨æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src/linux-2.6.23.12/arch/i386/kernel</span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰ i386 ç›®å½•ï¼Œå°è¯• x86 ç›®å½•</span></span><br><span class="line">sudo vim syscall_table.S</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶<strong>æœ«å°¾</strong>æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.long sys_mysyscall</span><br></pre></td></tr></table></figure>



<h4 id="2-3-æ·»åŠ ç³»ç»Ÿè°ƒç”¨å·"><a href="#2-3-æ·»åŠ ç³»ç»Ÿè°ƒç”¨å·" class="headerlink" title="2.3 æ·»åŠ ç³»ç»Ÿè°ƒç”¨å·"></a>2.3 æ·»åŠ ç³»ç»Ÿè°ƒç”¨å·</h4><p><strong>ä¿®æ”¹ç³»ç»Ÿå¤´æ–‡ä»¶</strong>ï¼ˆç”¨æˆ·ç©ºé—´ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/include/asm-i386/unistd.h</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_mysyscall 325</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¿®æ”¹å†…æ ¸å¤´æ–‡ä»¶</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/src/linux-2.6.23.12/include/asm-i386/unistd.h</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_mysyscall 325</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶å°†åŸæœ‰çš„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NR_syscalls 325</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NR_syscalls 326</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æç¤º</strong>ï¼šå¦‚æœè¦æ·»åŠ å¤šä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä¾æ¬¡é€’å¢è°ƒç”¨å·ï¼ˆ326, 327â€¦ï¼‰</p>
</blockquote>
<h3 id="3-ç¼–è¯‘å†…æ ¸"><a href="#3-ç¼–è¯‘å†…æ ¸" class="headerlink" title="3. ç¼–è¯‘å†…æ ¸"></a>3. ç¼–è¯‘å†…æ ¸</h3><h4 id="3-1-é…ç½®å†…æ ¸"><a href="#3-1-é…ç½®å†…æ ¸" class="headerlink" title="3.1 é…ç½®å†…æ ¸"></a>3.1 é…ç½®å†…æ ¸</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src/linux-2.6.23.12</span><br><span class="line">sudo make menuconfig</span><br></pre></td></tr></table></figure>

<p>åœ¨èœå•ä¸­ä¿æŒé»˜è®¤é…ç½®å³å¯ï¼Œç›´æ¥ä¿å­˜é€€å‡ºã€‚</p>
<h4 id="3-2-ç¼–è¯‘å†…æ ¸é•œåƒ"><a href="#3-2-ç¼–è¯‘å†…æ ¸é•œåƒ" class="headerlink" title="3.2 ç¼–è¯‘å†…æ ¸é•œåƒ"></a>3.2 ç¼–è¯‘å†…æ ¸é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make bzImage</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>è€—æ—¶</strong>ï¼šçº¦ 30-60 åˆ†é’Ÿ</p>
</blockquote>
<h4 id="3-3-ç¼–è¯‘å†…æ ¸æ¨¡å—"><a href="#3-3-ç¼–è¯‘å†…æ ¸æ¨¡å—" class="headerlink" title="3.3 ç¼–è¯‘å†…æ ¸æ¨¡å—"></a>3.3 ç¼–è¯‘å†…æ ¸æ¨¡å—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make modules</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>è€—æ—¶</strong>ï¼šçº¦ 1-2 å°æ—¶ï¼ˆè™šæ‹Ÿæœºä¼šæ›´æ…¢ï¼‰<br><strong>å»ºè®®</strong>ï¼šæ­¤æ—¶å¯ä»¥ä¼‘æ¯ä¸€ä¸‹ï¼Œå–æ¯å’–å•¡æˆ–æ‰“æ‰“çƒ ğŸ˜Š</p>
</blockquote>
<h4 id="3-4-å®‰è£…æ¨¡å—"><a href="#3-4-å®‰è£…æ¨¡å—" class="headerlink" title="3.4 å®‰è£…æ¨¡å—"></a>3.4 å®‰è£…æ¨¡å—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make modules_install</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåä¼šåœ¨ <code>/lib/modules/</code> ä¸‹ç”Ÿæˆ <code>2.6.23.12</code> ç›®å½•ã€‚</p>
<h4 id="3-5-å®‰è£…å†…æ ¸"><a href="#3-5-å®‰è£…å†…æ ¸" class="headerlink" title="3.5 å®‰è£…å†…æ ¸"></a>3.5 å®‰è£…å†…æ ¸</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶å†…æ ¸é•œåƒ</span></span><br><span class="line">sudo <span class="built_in">cp</span> <span class="built_in">arch</span>/i386/boot/bzImage /boot/vmlinuz-2.6.23.12</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆ initramfs</span></span><br><span class="line">sudo mkinitramfs -o /boot/initrd.img-2.6.23.12 2.6.23.12</span><br></pre></td></tr></table></figure>



<h3 id="4-é…ç½®-GRUB-å¼•å¯¼"><a href="#4-é…ç½®-GRUB-å¼•å¯¼" class="headerlink" title="4. é…ç½® GRUB å¼•å¯¼"></a>4. é…ç½® GRUB å¼•å¯¼</h3><h4 id="4-1-ç¼–è¾‘-GRUB-é…ç½®æ–‡ä»¶"><a href="#4-1-ç¼–è¾‘-GRUB-é…ç½®æ–‡ä»¶" class="headerlink" title="4.1 ç¼–è¾‘ GRUB é…ç½®æ–‡ä»¶"></a>4.1 ç¼–è¾‘ GRUB é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /boot/grub/menu.lst</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">sudo vim /boot/grub/grub.conf</span><br></pre></td></tr></table></figure>



<h4 id="4-2-æ·»åŠ æ–°å†…æ ¸å¯åŠ¨é¡¹"><a href="#4-2-æ·»åŠ æ–°å†…æ ¸å¯åŠ¨é¡¹" class="headerlink" title="4.2 æ·»åŠ æ–°å†…æ ¸å¯åŠ¨é¡¹"></a>4.2 æ·»åŠ æ–°å†…æ ¸å¯åŠ¨é¡¹</h4><p>åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title Ubuntu 7.10, kernel 2.6.22-14-generic</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel /boot/vmlinuz-2.6.22-14-generic root=UUID=e2478f9d-7f5d-458f-b017-43458a8f62ea ro quiet splash</span><br><span class="line">initrd /boot/initrd.img-2.6.22-14-generic</span><br><span class="line">quiet</span><br></pre></td></tr></table></figure>

<p>ä»¿ç…§æ ¼å¼æ·»åŠ æ–°å†…æ ¸é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title Ubuntu 7.10, kernel 2.6.23.12 (Custom)</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel /boot/vmlinuz-2.6.23.12 root=UUID=e2478f9d-7f5d-458f-b017-43458a8f62ea ro quiet splash</span><br><span class="line">initrd /boot/initrd.img-2.6.23.12</span><br><span class="line">quiet</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>UUID</code> éœ€è¦æ›¿æ¢ä¸ºä½ è‡ªå·±çš„åˆ†åŒº UUIDï¼Œå¯é€šè¿‡ <code>sudo blkid</code> æŸ¥çœ‹ã€‚</p>
</blockquote>
<h4 id="4-3-æ˜¾ç¤º-GRUB-èœå•"><a href="#4-3-æ˜¾ç¤º-GRUB-èœå•" class="headerlink" title="4.3 æ˜¾ç¤º GRUB èœå•"></a>4.3 æ˜¾ç¤º GRUB èœå•</h4><p>æ³¨é‡Šæ‰éšè—èœå•é€‰é¡¹ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#hiddenmenu</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜å¹¶é€€å‡ºã€‚</p>
<h3 id="5-é‡å¯ç³»ç»Ÿ"><a href="#5-é‡å¯ç³»ç»Ÿ" class="headerlink" title="5. é‡å¯ç³»ç»Ÿ"></a>5. é‡å¯ç³»ç»Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<p>åœ¨ GRUB å¯åŠ¨èœå•ä¸­é€‰æ‹©æ–°ç¼–è¯‘çš„å†…æ ¸ <code>kernel 2.6.23.12 (Custom)</code> å¯åŠ¨ã€‚</p>
<h2 id="ğŸ§ª-æµ‹è¯•è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨"><a href="#ğŸ§ª-æµ‹è¯•è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ğŸ§ª æµ‹è¯•è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨"></a>ğŸ§ª æµ‹è¯•è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨</h2><h3 id="ç¼–å†™æµ‹è¯•ç¨‹åº"><a href="#ç¼–å†™æµ‹è¯•ç¨‹åº" class="headerlink" title="ç¼–å†™æµ‹è¯•ç¨‹åº"></a>ç¼–å†™æµ‹è¯•ç¨‹åº</h3><p>åˆ›å»º <code>test.c</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_mysyscall 325</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è°ƒç”¨è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨ mysyscall...\n&quot;</span>);</span><br><span class="line">    result = syscall(__NR_mysyscall, <span class="number">42</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼: %d\n&quot;</span>, result);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ç¼–è¯‘å¹¶è¿è¡Œ"><a href="#ç¼–è¯‘å¹¶è¿è¡Œ" class="headerlink" title="ç¼–è¯‘å¹¶è¿è¡Œ"></a>ç¼–è¯‘å¹¶è¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -o <span class="built_in">test</span> test.c</span><br><span class="line">./test</span><br></pre></td></tr></table></figure>

<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨è‡ªå®šä¹‰ç³»ç»Ÿè°ƒç”¨ mysyscall...</span><br><span class="line">ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼: 42</span><br></pre></td></tr></table></figure>



<h3 id="æŸ¥çœ‹å†…æ ¸æ—¥å¿—"><a href="#æŸ¥çœ‹å†…æ ¸æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹å†…æ ¸æ—¥å¿—"></a>æŸ¥çœ‹å†…æ ¸æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | <span class="built_in">tail</span></span><br></pre></td></tr></table></figure>

<p>åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[12345.678901] Hello from mysyscall! Received: 42</span><br></pre></td></tr></table></figure>



<h2 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="é—®é¢˜-1ï¼šæ‰¾ä¸åˆ°-i386-ç›®å½•"><a href="#é—®é¢˜-1ï¼šæ‰¾ä¸åˆ°-i386-ç›®å½•" class="headerlink" title="é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ° i386 ç›®å½•"></a>é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ° <code>i386</code> ç›®å½•</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ–°ç‰ˆæœ¬å†…æ ¸å¯èƒ½ä½¿ç”¨ <code>x86</code> ç›®å½•ï¼Œä¿®æ”¹è·¯å¾„ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src/linux-2.6.23.12/arch/x86/kernel</span><br></pre></td></tr></table></figure>



<h3 id="é—®é¢˜-2ï¼šmake-modules-éå¸¸æ…¢"><a href="#é—®é¢˜-2ï¼šmake-modules-éå¸¸æ…¢" class="headerlink" title="é—®é¢˜ 2ï¼šmake modules éå¸¸æ…¢"></a>é—®é¢˜ 2ï¼š<code>make modules</code> éå¸¸æ…¢</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å¤šæ ¸ç¼–è¯‘ï¼š<code>sudo make -j4 modules</code>ï¼ˆ4 ä¸º CPU æ ¸å¿ƒæ•°ï¼‰</li>
<li>è™šæ‹Ÿæœºåˆ†é…æ›´å¤š CPU å’Œå†…å­˜</li>
</ul>
<h3 id="é—®é¢˜-3ï¼šç¼–è¯‘æŠ¥é”™ç¼ºå°‘ä¾èµ–"><a href="#é—®é¢˜-3ï¼šç¼–è¯‘æŠ¥é”™ç¼ºå°‘ä¾èµ–" class="headerlink" title="é—®é¢˜ 3ï¼šç¼–è¯‘æŠ¥é”™ç¼ºå°‘ä¾èµ–"></a>é—®é¢˜ 3ï¼šç¼–è¯‘æŠ¥é”™ç¼ºå°‘ä¾èµ–</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå®‰è£…å¿…è¦çš„ç¼–è¯‘å·¥å…·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install build-essential libncurses5-dev</span><br></pre></td></tr></table></figure>



<h3 id="é—®é¢˜-4ï¼šç³»ç»Ÿè°ƒç”¨è¿”å›-1"><a href="#é—®é¢˜-4ï¼šç³»ç»Ÿè°ƒç”¨è¿”å›-1" class="headerlink" title="é—®é¢˜ 4ï¼šç³»ç»Ÿè°ƒç”¨è¿”å› -1"></a>é—®é¢˜ 4ï¼šç³»ç»Ÿè°ƒç”¨è¿”å› -1</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ç³»ç»Ÿè°ƒç”¨å·æ˜¯å¦æ­£ç¡®</li>
<li>ç¡®è®¤ <code>NR_syscalls</code> å·²æ›´æ–°</li>
<li>æŸ¥çœ‹ <code>dmesg</code> è¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</li>
</ul>
<h2 id="âœ…-æ€»ç»“ä¸å»ºè®®"><a href="#âœ…-æ€»ç»“ä¸å»ºè®®" class="headerlink" title="âœ… æ€»ç»“ä¸å»ºè®®"></a>âœ… æ€»ç»“ä¸å»ºè®®</h2><h3 id="å…³é”®è¦ç‚¹"><a href="#å…³é”®è¦ç‚¹" class="headerlink" title="å…³é”®è¦ç‚¹"></a>å…³é”®è¦ç‚¹</h3><ol>
<li><strong>è€å¿ƒ</strong>ï¼šå†…æ ¸ç¼–è¯‘è€—æ—¶è¾ƒé•¿ï¼Œå°¤å…¶æ˜¯ <code>make modules</code></li>
<li><strong>å¤‡ä»½</strong>ï¼šä¿®æ”¹å‰å¤‡ä»½é‡è¦æ–‡ä»¶</li>
<li><strong>ç‰ˆæœ¬åŒ¹é…</strong>ï¼šç¡®ä¿å†…æ ¸ç‰ˆæœ¬ä¸æ•™ç¨‹ä¸€è‡´</li>
<li><strong>æ—¥å¿—æŸ¥çœ‹</strong>ï¼šå–„ç”¨ <code>dmesg</code> è°ƒè¯•</li>
</ol>
<h3 id="å­¦ä¹ æ”¶è·"><a href="#å­¦ä¹ æ”¶è·" class="headerlink" title="å­¦ä¹ æ”¶è·"></a>å­¦ä¹ æ”¶è·</h3><ul>
<li>ç†è§£ Linux å†…æ ¸ç¼–è¯‘æµç¨‹</li>
<li>æŒæ¡ç³»ç»Ÿè°ƒç”¨æ·»åŠ æ–¹æ³•</li>
<li>ç†Ÿæ‚‰å†…æ ¸æ¨¡å—æœºåˆ¶</li>
<li>æå‡ Linux ç³»ç»Ÿåº•å±‚è®¤çŸ¥</li>
</ul>
<h2 id="ğŸ“š-å‚è€ƒèµ„æ–™"><a href="#ğŸ“š-å‚è€ƒèµ„æ–™" class="headerlink" title="ğŸ“š å‚è€ƒèµ„æ–™"></a>ğŸ“š å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.kernel.org/">Linux Kernel Archives</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/">The Linux Kernel Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md">Linux System Call Table</a></li>
</ul>
<p><strong>ç¥å„ä½å®éªŒé¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜æ¬¢è¿äº¤æµè®¨è®ºï¼</strong> ğŸ‰</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/hexo-blog/" rel="next" title="åœ¨Githubä¸Šç”¨Hexoæ­å»ºä¸ªäººBlog">
                  åœ¨Githubä¸Šç”¨Hexoæ­å»ºä¸ªäººBlog <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2008 â€“ 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eazow</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">209k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:10</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<script>
  const numberOfBanners = 10;
  const randomNum = Math.random() * numberOfBanners | 0;
  const banner = document.querySelector('.banner');
//   document.getElementsByClassName("banner")[0].style.backgroundImage =
//   const imageExtension = randomNum === 9 ? ".webp" : ".jpeg";
  const imageExtension = ".webp";
  const url = "url('https://hyz-blog.oss-cn-hangzhou.aliyuncs.com/banner" + randomNum + imageExtension + "')";
  banner.style.backgroundImage = url;
</script>


    </div>
  </footer>

  
  <script size="200" alpha="0.2" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/schemes/muse.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/next-boot.min.js"></script>

  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.2/third-party/pace.min.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <!--script async src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@2.3/bsz.pure.mini.js"></script-->




<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"eazow/hexo","repo_id":"MDEwOlJlcG9zaXRvcnkxNjI1NTM4Nzk=","category":"Announcements","category_id":"DIC_kwDOCbBgF84CQl0J","mapping":"pathname","reactions_enabled":1,"emit_metadata":0,"theme":"light","lang":"en","crossorigin":"anonymous","input_position":"top","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
